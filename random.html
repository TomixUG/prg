<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1 class="title">URL shortener</h1>
      <nav>
        <ul>
          <li><a href="#shorten">Shorten shortener</a></li>
          <li><a href="#how">How does it work</a></li>
          <li><a href="#about">About us</a></li>
          <!-- <li></li> -->
        </ul>
      </nav>
    </header>

    <div class="shortenBox" id="shorten">
      <label for="url">Enter URL here:</label>
      <input type="text" name="url" id="url" required />
      <button id="submitButton">Shorten URL!</button>
      <br />
      <a href="" id="result" target="_blank"></a>
      <p id="requestInfo"></p>
    </div>

    <div class="content">
      <div class="section">
        <h2 id="how">But how does it work?</h2>
        <p>
          We use free
          <a href="https://tinyurl.com" target="_blank">tinyurl.com</a> API to
          process the requests
          <br />
          We send <span class="code">GET</span> request to the tinyurl API
          server
          <span class="code">https://tinyurl.com/api-create.php?url=</span>
          <br />
          It works very well
        </p>
        <br />
        <p>
          <u> Warning: </u> <br />
          there is API limit of 600 requests per month
        </p>
      </div>

      <div class="section">
        <h2 id="#about">About us</h2>
        <p>We are not affiliated with tinyurl.com in any way</p>
        <p>
          But that does not mean that we are a small company. We infact have
          many employees
        </p>
        <!-- <table border="1">
          <tr>
            <th>Company</th>
            <th>Contact</th>
            <th>Country</th>
          </tr>
          <tr>
            <td>Alfreds Futterkiste</td>
            <td>Maria Anders</td>
            <td>Germany</td>
          </tr>
          <tr>
            <td>Centro comercial Moctezuma</td>
            <td>Francisco Chang</td>
            <td>Mexico</td>
          </tr>
        </table> -->
      </div>
    </div>

    <script>
      var button = document.getElementById("submitButton");
      var urlInput = document.getElementById("url");
      var a = document.getElementById("result");
      var p = document.getElementById("requestInfo");

      button.addEventListener("click", () => {
        console.log(urlInput.value);
        processRequest(urlInput.value);
      });

      async function processRequest(value) {
        if (value === "") {
          p.innerText = "Please enter url";
          return;
        }
        a.text = "";
        p.innerText = "Loading....";
        button.disabled = true;
        var response = await fetch(
          "https://tinyurl.com/api-create.php?url=" + urlInput.value
        );
        console.log(response.status);

        if (response.status === 400) {
          p.innerText = "You entered invalid link!";
          a.text = "";
          a.href = "";
          button.disabled = false;
          return;
        } else if (response.status !== 200) {
          p.innerText = "Unknown error has occured";
          a.text = "";
          a.href = "";
          button.disabled = false;
          return;
        }
        var data = await response.text();
        console.log(data);

        p.innerText = "";
        a.text = data;
        a.href = data;
        button.disabled = false;
      }
    </script>
  </body>
</html>
